package thinking.in.java;


import org.apache.commons.httpclient.*;

import org.apache.commons.httpclient.auth.AuthScope;
import org.apache.commons.httpclient.cookie.CookiePolicy;
import org.apache.commons.httpclient.methods.GetMethod;
import org.apache.commons.httpclient.params.HttpMethodParams;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

/**
 * Created by seasen on 2016/3/25.
 */
public class proxyServer {
    public static void main(String[] args) {
        proxyServer p = new proxyServer();
        String [] ip = p.proxyIP();
        int [] port = p.proxyPort();
        for (int i = 0; i <ip.length ; i++) {
            p.testProxyServer(i,"http://m.weibo.cn/",ip[i],port[i]);
        }
    }
    private int testProxyServer(int i,String url, String proxyIp, int proxyPort) {
        HttpClient httpClient = new HttpClient();
        httpClient.getHostConfiguration().setProxy(proxyIp, proxyPort);
        List<Header> headers = new ArrayList<Header>();
        headers.add(new Header("User-Agent", "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)"));
        httpClient.getHostConfiguration().getParams().setParameter("http.default-headers", headers);
        GetMethod getMethod = new GetMethod(url);
        getMethod.getParams().setParameter(HttpMethodParams.RETRY_HANDLER,
                new DefaultHttpMethodRetryHandler(3, false));
        if(getMethod == null){
            //System.out.println("请求协议.设置都搞错了，所以我无法完成您的请求");
            return 0;
        }
       // System.out.println(i+":"+getMethod.getName());
        try {
            int statusCode = httpClient.executeMethod(getMethod);

            try {
                String str = new String(getMethod.getResponseBody(), "gb2312");
                if(str.contains("<title>"))
                    System.out.println(proxyPort+" "+proxyIp);
            } catch (IOException e) {
                return 0;
            }
            if (statusCode == HttpStatus.SC_OK) { //2XX状态码
                return HttpStatus.SC_OK;
            }else if(statusCode == HttpStatus.SC_FORBIDDEN){ //代理还是不行
                return HttpStatus.SC_FORBIDDEN;
            }else{  //  其他的错误
                return 0;
            }
        } catch (HttpException e) {
            // 发生致命的异常，可能是协议不对或者返回的内容有问题
           // System.out.println("Please check your provided http address!");
            return 0;
        } catch (IOException e) {
            // 发生网络异常
            return 0;
        }
    }
    public int[] proxyPort(){
        int [] port = {3128,80
                ,8083,8083
                ,8083
                ,8083
                ,80
                ,8083
                ,8083
                ,8083
                ,8083
                ,8083
                ,8083
                ,8083
                ,8083
                ,8083
                ,80
                ,8118
                ,8080
                ,888
                ,80
                ,81
                ,8090
                ,8118
                ,80
                ,81
                ,80
                ,80
                ,80
                ,8080
                ,81
                ,80
                ,80
                ,80
                ,3128
                ,80
                ,8000
                ,8090
                ,80
                ,80
                ,8081
                ,80
                ,80
                ,80
                ,80
                ,80
                ,80
                ,80
                ,80
                ,80
                ,80
                ,55555
                ,55555
                ,55555
                ,8088
                ,80
                ,80
                ,80
                ,80
                ,8118
                ,80
                ,4040
                ,4040
                ,80
                ,80
                ,80
                ,8118
                ,8080
                ,8118
                ,8118
                ,8080
                ,80
                ,80
                ,80
                ,80
                ,80
                ,80
                ,80
                ,80
                ,80
                ,80
                ,80
                ,81
                ,82
                ,843
                ,80
                ,82
                ,8080
                ,80
                ,8080
                ,8080
                ,80
                ,3128
                ,8080
                ,8000
                ,8080
                ,80
                ,80
                ,92
                ,8088
                ,8090
                ,80
                ,80
                ,8080
                ,8081
                ,80
                ,80
                ,8080
                ,80
                ,80
                ,8080
                ,80
                ,80
                ,8080
                ,80
                ,8080
                ,80
                ,8000
                ,8081
                ,8080
                ,8118
                ,3128
                ,3128
                ,80
                ,80
                ,80
                ,81
                ,82
                ,83
                ,843
                ,8080
                ,80
                ,80
                ,81
                ,843
                ,8118
                ,8118
                ,80
                ,3128
                ,8088
                ,80
                ,80
                ,80
                ,3128
                ,3128
                ,80
                ,9999
                ,80
                ,80
                ,80
                ,7004
                ,8118
                ,80
                ,3128
                ,80
                ,8118
                ,8118
                ,8080
                ,8888
                ,3128
                ,3128
                ,8080
                ,8888
                ,8080
                ,8080
                ,8080
                ,8080
                ,8080
                ,80
                ,3128
                ,80
                ,8080
                ,8080
                ,80
                ,8080
                ,8080
                ,8080
                ,3128
                ,8080
                ,8080
                ,8080
                ,8080
                ,80
                ,80
                ,80
                ,80
                ,80
                ,80
                ,80
                ,80
                ,80
                ,81
                ,80
                ,80
                ,8080
                ,808
                ,8080
                ,8118
                ,80
                ,8080
                ,80
                ,81
                ,82
                ,8888
                ,80
                ,8118
                ,8118
                ,80
                ,8086
                ,8086
                ,80
                ,8080};
        return port;
    }
    public String[] proxyIP(){
        String [] ip = {
                "51.254.103.206",
                "51.255.161.222",
                "52.10.30.100",
                "52.10.201.200",
                "52.10.220.157",
                "52.32.21.15",
                "52.70.121.121",
                "52.91.19.158",
                "52.91.98.77",
                "52.91.115.105",
                "52.91.174.197",
                "52.91.188.146",
                "52.91.189.55",
                "52.91.189.178",
                "52.91.238.13",
                "54.183.196.251",
                "54.223.78.5",
                "58.40.81.135",
                "58.247.30.222",
                "59.58.162.141",
                "59.125.130.154",
                "60.13.74.184",
                "60.195.250.55",
                "61.48.59.237",
                "61.174.13.12",
                "61.235.125.26",
                "78.36.171.228",
                "80.149.99.130",
                "82.200.81.233",
                "84.51.81.217",
                "85.143.164.100",
                "86.105.212.38",
                "88.198.163.58",
                "94.23.158.49",
                "95.168.217.24",
                "101.226.249.237",
                "103.47.193.102",
                "103.51.145.85",
                "104.236.220.70",
                "105.211.254.16",
                "106.75.197.134",
                "106.249.176.213",
                "107.151.136.195",
                "107.151.136.204",
                "107.151.136.205",
                "107.151.136.222",
                "107.151.142.115",
                "107.151.142.123",
                "107.151.142.124",
                "107.151.152.210",
                "107.151.152.218",
                "108.59.10.129",
                "108.59.10.135",
                "108.59.10.141",
                "110.81.238.173",
                "111.11.228.88",
                "111.13.109.41",
                "111.40.197.10",
                "111.56.13.150",
                "111.126.230.56",
                "112.25.41.136",
                "112.90.179.153",
                "113.107.202.25",
                "113.254.254.11",
                "113.255.49.49",
                "113.255.129.42",
                "114.95.185.39",
                "115.159.5.247",
                "116.226.11.168",
                "116.231.156.193",
                "117.21.182.109",
                "117.21.182.110",
                "117.135.251.130",
                "117.135.251.131",
                "117.135.251.132",
                "117.135.251.133",
                "117.135.251.134",
                "117.135.251.135",
                "117.135.251.136",
                "117.136.234.1",
                "117.136.234.6",
                "117.136.234.8",
                "117.136.234.8",
                "117.136.234.8",
                "117.136.234.8",
                "117.177.250.151",
                "117.177.250.151",
                "117.177.250.151",
                "117.177.250.152",
                "117.177.250.152",
                "117.240.209.39",
                "118.97.66.2",
                "118.189.157.9",
                "118.194.195.106",
                "120.26.97.149",
                "120.26.219.12",
                "120.52.72.32",
                "120.52.73.149",
                "120.52.73.149",
                "120.52.73.149",
                "120.52.73.149",
                "120.198.231.21",
                "120.198.231.22",
                "120.198.231.22",
                "120.198.231.22",
                "120.198.231.23",
                "120.198.231.24",
                "120.198.231.24",
                "120.198.231.85",
                "120.198.231.86",
                "120.198.231.86",
                "120.198.231.87",
                "120.198.231.88",
                "120.198.231.88",
                "120.198.233.211",
                "120.198.233.211",
                "121.40.108.76",
                "121.41.19.66",
                "121.42.51.126",
                "121.69.33.158",
                "121.69.36.122",
                "121.88.249.28",
                "121.88.249.29",
                "121.193.143.249",
                "122.96.59.104",
                "122.96.59.107",
                "122.96.59.107",
                "122.96.59.107",
                "122.96.59.107",
                "122.96.59.107",
                "122.226.77.226",
                "122.248.184.229",
                "123.56.237.214",
                "124.88.67.20",
                "124.88.67.20",
                "124.200.184.206",
                "124.202.181.186",
                "124.244.77.129",
                "125.39.67.194",
                "125.64.5.2",
                "134.249.168.16",
                "136.243.175.186",
                "136.243.175.189",
                "136.243.197.251",
                "139.162.24.127",
                "139.196.4.11",
                "139.196.174.42",
                "149.202.49.42",
                "152.160.35.171",
                "154.127.138.5",
                "173.220.170.242",
                "175.25.25.134",
                "177.101.181.169",
                "180.76.135.145",
                "180.76.178.140",
                "180.175.110.112",
                "180.175.182.32",
                "182.254.153.54",
                "183.61.71.112",
                "183.61.236.53",
                "183.111.169.208",
                "183.129.134.226",
                "183.131.76.27",
                "183.234.48.201",
                "183.239.167.122",
                "183.239.173.138",
                "183.252.18.131",
                "186.219.0.136",
                "189.28.166.79",
                "190.202.84.236",
                "190.221.23.158",
                "191.7.212.241",
                "193.173.47.214",
                "193.226.180.113",
                "195.229.210.184",
                "200.35.187.114",
                "201.175.12.170",
                "202.77.57.124",
                "203.195.160.14",
                "203.195.162.96",
                "203.195.172.147",
                "203.195.204.168",
                "210.75.218.121",
                "210.129.16.74",
                "210.140.96.173",
                "210.140.193.161",
                "210.140.195.59",
                "210.140.216.214",
                "210.152.242.248",
                "210.209.121.215",
                "211.143.146.230",
                "211.143.146.230",
                "213.136.79.122",
                "213.136.79.124",
                "216.56.48.131",
                "218.2.0.40",
                "218.26.120.170",
                "218.56.40.208",
                "218.57.113.166",
                "218.78.210.190",
                "218.106.96.199",
                "218.106.96.199",
                "218.106.96.199",
                "218.244.140.99",
                "219.141.225.149",
                "220.179.227.86",
                "220.249.21.222",
                "221.176.14.72",
                "222.188.100.203",
                "222.188.100.204",
                "223.19.212.30",
                "223.27.194.166"};
        return ip;
    }
}
